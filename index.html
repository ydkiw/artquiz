<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>미술품 퀴즈 게임</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #f0f0f0;
    }
    .container {
      display: flex;
      flex-direction: column;
      width: 90%;
      max-width: 1000px;
      height: 80%;
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    #api-key-screen, #game-screen { display: none; }
    #api-key-screen {
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    #game-screen { flex: 1; }

    /* 공통 스타일 */
    .timer-bar { width: 100%; height: 10px; background-color: #eeeeee; }
    .timer-bar .fill { width: 100%; height: 100%; background-color: #4caf50; }
    .content { display: flex; flex: 1; }
    .left-section { flex: 2; display: flex; justify-content: center; align-items: center; background-color: #eeeeee; }
    .left-section img { max-width: 90%; max-height: 90%; border-radius: 8px; }
    .right-section { flex: 3; padding: 20px; }
    .question-box { background-color: #333; color: white; padding: 15px; border-radius: 8px; font-size: 18px; line-height: 1.6; }
    .choices { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; }
    .choices button { padding: 15px; font-size: 16px; background-color: #444; color: white; border: none; border-radius: 5px; cursor: pointer; transition: 0.3s; }
    .choices button.correct { animation: correctEffect 2s ease-out forwards; }
    .choices button.wrong { animation: wrongEffect 0.6s ease-out, shake 0.4s ease; }

/* 정답 효과: 하얗게 빛나고 초록 드롭섀도우 */
@keyframes correctEffect {
  0% {
    background-color: white;
    color: #444;
    box-shadow: 0 0 15px 5px rgba(0, 255, 0, 0.7);
  }
  100% {
    background-color: #4caf50; /* 초록색 */
    color: white;
    box-shadow: 0 0 0 0 rgba(0, 255, 0, 0);
  }
}

/* 오답 효과: 빨간 테두리 및 흔들림 */
@keyframes wrongEffect {
  0% {
    box-shadow: 0 0 10px 5px rgba(255, 0, 0, 0.7);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(255, 0, 0, 0);
  }
}

@keyframes shake {
  0%, 100% {
    transform: translateX(0);
  }
  25% {
    transform: translateX(-5px);
  }
  75% {
    transform: translateX(5px);
  }
}

.choices button.correct {
  animation: correctEffect 2s ease-out forwards;
}

.choices button.wrong {
  animation: wrongEffect 0.6s ease-out, shake 0.4s ease;
}

  </style>
</head>
<body>

<div id="api-key-screen">
  <h1>API 키를 입력하세요</h1>
  <input type="text" id="api-key-input" placeholder="OpenAI API Key" style="padding: 10px; width: 80%; max-width: 400px;">
  <button id="api-key-submit" style="margin-top: 20px; padding: 10px 20px;">시작</button>
  <p><a href="https://outstanding-nitrogen-37e.notion.site/api-1238fee049fb80059437e6db855eb5f1">비밀의 키 얻기</a>
</div>

<div class="container" id="game-screen">
  <!-- Timer Bar -->
  <div class="timer-bar">
    <div class="fill" id="timer-fill"></div>
  </div>
  <!-- 왼쪽 미술품 이미지 영역 -->
  <div class="content">
    <div class="left-section">
      <img src="" alt="미술품 이미지" id="art-image">
    </div>

    <!-- 오른쪽 문제 영역 -->
    <div class="right-section">
      <div class="question-box" id="question">
        문제가 로드됩니다...
      </div>
      <div class="choices">
        <button id="choice-0" onclick="checkAnswer(0)">선택지 1</button>
        <button id="choice-1" onclick="checkAnswer(1)">선택지 2</button>
        <button id="choice-2" onclick="checkAnswer(2)">선택지 3</button>
      </div>
    </div>
  </div>
</div>

<script>
  let userApiKey = ''; // API 키 저장
  let currentQuestionIndex = 0; // 현재 퀴즈 인덱스
  let questions = []; // 생성된 질문 목록

  const quizData = [
    { prompt: "모나리자와 관련된 퀴즈를 만들어주세요.", image: "monalisa.jpg" },
    { prompt: "진주 귀고리를 한 소녀와 관련된 퀴즈를 만들어주세요.", image: "pearl_earring.jpg" },
  ];

  document.getElementById('api-key-submit').addEventListener('click', async () => {
    userApiKey = document.getElementById('api-key-input').value.trim();
    if (!userApiKey) {
      alert('API Key를 입력해주세요.');
      return;
    }

    // API 키 입력 화면 숨기기
    document.getElementById('api-key-screen').style.display = 'none';
    document.getElementById('game-screen').style.display = 'block';

    // 질문 로드
    await loadQuestions();
    loadQuestion();
  });

  // GPT 요청 함수
  async function callGPT(prompt) {
    try {
      const response = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${userApiKey}`,
        },
        body: JSON.stringify({
          model: 'gpt-4o-mini',
          messages: [{ role: 'user', content: prompt }],
          max_tokens: 150,
          temperature: 0.7,
        }),
      });

      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }

      const data = await response.json();
      return data.choices[0].message.content;
    } catch (error) {
      console.error('API 호출 오류:', error);
      return null;
    }
  }

async function loadQuestions() {
  for (const item of quizData) {
    const prompt = `
      당신은 퀴즈를 만드는 전문가입니다. 아래의 예술작품에 대해 간단한 퀴즈를 만들어 주세요.
      요구사항:
      1. 질문은 완성된 문장으로 작성해 주세요.
      2. 정답을 포함한 총 3개의 선택지를 제공해 주세요.
      3. 정답은 항상 무작위의 선택지에 위치해 있어야 합니다.

      예술작품: ${item.prompt}
      작품과 관련된 문제를 작성하고, 아래의 형식에 맞게 답변을 반환하세요:

      질문: [질문을 입력하세요]
      - [선택지 1]
      - [선택지 2]
      - [선택지 3]
    `;

    const questionContent = await callGPT(prompt);

    if (questionContent) {
      const parsed = questionContent.split('\n');
      const question = parsed[0].replace('질문: ', '').trim();
      const options = parsed.slice(1, 4).map(opt => opt.replace(/^[-•]\s*/, '').trim());

      // 정답 위치 추출 (예: 정답은 항상 API 응답의 첫 번째 옵션으로 가정)
      const correctAnswerIndex = 0;

      

      questions.push({
        question,
        options,
        correctAnswerIndex,
        image: item.image,
      });
    } else {
      questions.push({
        question: '질문 생성에 실패했습니다.',
        options: ['다시 시도', '오류 발생', 'API 확인'],
        correctAnswerIndex: 0,
        image: '',
      });
    }
  }
}


function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}



function loadQuestion() {
  const questionData = questions[currentQuestionIndex];
  document.getElementById('question').innerText = questionData.question;
  document.getElementById('art-image').src = questionData.image;

  questionData.options.forEach((option, index) => {
    const button = document.getElementById(`choice-${index}`);
    button.innerText = option;
    button.disabled = false;
    button.classList.remove('correct', 'wrong');

    // 클릭 시 정답 확인
    button.onclick = () => checkAnswer(index);
  });
}

function checkAnswer(selectedIndex) {
  const questionData = questions[currentQuestionIndex];
  const buttons = document.querySelectorAll('.choices button');

  buttons.forEach((button, index) => {
    button.disabled = true;
    if (index === questionData.correctAnswerIndex) {
      button.classList.add('correct'); // 정답 애니메이션
    } else {
      button.classList.add('wrong'); // 오답 애니메이션
    }
  });

  setTimeout(() => {
    currentQuestionIndex++;
    if (currentQuestionIndex < questions.length) {
      loadQuestion();
    } else {
      endQuiz();
    }
  }, 2000);
}




  // 퀴즈 종료
  function endQuiz() {
    document.body.innerHTML = `
      <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh;">
        <h1>퀴즈 완료!</h1>
        <p>모든 문제를 완료했습니다!</p>
      </div>
    `;
  }
</script>

</body>
</html>
